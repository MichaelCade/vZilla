<!DOCTYPE html>
<html xmlns:fb="http://www.facebook.com/2008/fbml">
<head>
<title>Blog Archives - vZilla.co.uk</title>
<meta property='og:site_name' content='vZilla.co.uk' />
<meta property='og:title' content='Blog Archives' />
<meta property='og:description' content='I have been asked by a number of people since joining Veeam about the NetApp Storage Snapshot Support in version 8 of the software. This is the reason for this post to try and outline the Why and the...' />
<meta property='og:image' content='http://vzilla.co.uk/uploads/3/2/3/9/3239227/4739166.png' />
<meta property='og:image' content='http://vzilla.co.uk/uploads/3/2/3/9/3239227/2226652_orig.png' />
<meta property='og:image' content='http://vzilla.co.uk/uploads/3/2/3/9/3239227/4394562_orig.png' />
<meta property='og:image' content='http://vzilla.co.uk/uploads/3/2/3/9/3239227/7540652_orig.png' />
<meta property='og:image' content='http://vzilla.co.uk/uploads/3/2/3/9/3239227/6596939_orig.png' />
<meta property='og:image' content='http://vzilla.co.uk/uploads/3/2/3/9/3239227/8340134_orig.png' />
<meta property='og:url' content='http://vzilla.co.uk/1/archives/04-2015/1.html' />
<meta http-equiv='cache-control' content='no-cache' />
<link rel='alternate' type='application/rss+xml' title='RSS 2.0' href='http://vzilla.co.uk/1/feed' />

<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<link rel="stylesheet" href="//assets.dragndropbuilder.com/css/sites.css?buildTime=1432850078" type="text/css" /><link rel='stylesheet' type='text/css' href='http://www.dragndropbuilder.com/editor/libraries/fancybox/fancybox.css?1432850078' />
<link rel='stylesheet' type='text/css' href='/files/main_style.css?1452789018' title='wsite-theme-css' />
<style type='text/css'>
.wsite-elements div.paragraph, .wsite-elements p, .wsite-elements .product-block .product-title, .wsite-elements .product-description, .wsite-elements .wsite-form-field label, .wsite-elements .wsite-form-field label, #wsite-content div.paragraph, #wsite-content p, #wsite-content .product-block .product-title, #wsite-content .product-description, #wsite-content .wsite-form-field label, #wsite-content .wsite-form-field label, .blog-sidebar div.paragraph, .blog-sidebar p, .blog-sidebar .wsite-form-field label, .blog-sidebar .wsite-form-field label {}
#wsite-content div.paragraph, #wsite-content p, #wsite-content .product-block .product-title, #wsite-content .product-description, #wsite-content .wsite-form-field label, #wsite-content .wsite-form-field label, .blog-sidebar div.paragraph, .blog-sidebar p, .blog-sidebar .wsite-form-field label, .blog-sidebar .wsite-form-field label {}
.wsite-elements h2, .wsite-elements .product-long .product-title, .wsite-elements .product-large .product-title, .wsite-elements .product-small .product-title, #wsite-content h2, #wsite-content .product-long .product-title, #wsite-content .product-large .product-title, #wsite-content .product-small .product-title, .blog-sidebar h2 {}
#wsite-content h2, #wsite-content .product-long .product-title, #wsite-content .product-large .product-title, #wsite-content .product-small .product-title, .blog-sidebar h2 {}
#wsite-title {}
</style>
<script><!--
var STATIC_BASE = 'http://www.dragndropbuilder.com/';
var STYLE_PREFIX = 'wsite';
//-->
</script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'></script>
<script src='../../../assets.dragndropbuilder.com/js/site/main.js@buildTime=1432850078'></script>
<script type='text/javascript'><!--
(function(jQuery){
function initFlyouts(){initPublishedFlyoutMenus([{"id":"585258828175266744","title":"Home","url":"index.html","target":""},{"id":"127302207674349487","title":"About vZilla","url":"about-vzilla.html","target":""},{"id":"459605263778525960","title":"vZilla HomeLab","url":"vzilla-homelab.html","target":""},{"id":"894781723381334435","title":"vZilla Blog","url":"vzilla-blog.html","target":""}],'894781723381334435',"<li class='wsite-nav-more'><a href='#'>more...<\/a><\/li>",'active',false)}
if (jQuery) {
if (jQuery.browser.msie && !window.flyoutMenusRefreshable) window.onload = initFlyouts;
else jQuery(initFlyouts);
}else{
if (Prototype.Browser.IE) window.onload = initFlyouts;
else document.observe('dom:loaded', initFlyouts);
}
})(window._W && _W.jQuery)
//-->
</script>
</head>
<body class='wsite-theme-light no-header-page wsite-page-vzilla-blog'>
<div id="container">
	<table id="header">
		<tr>
			<td id="logo"><span class='wsite-logo'><a href='../../../index.html'><img src='../../../uploads/3/2/3/9/3239227/4739166.png' /></a></span></td>
			<td id="header-right">
				<table>
					<tr>
						<td class="phone-number"></td>
						<td class="social"><div style="text-align:left;"><div style="height:0px;overflow:hidden"></div>
<span class="wsite-social wsite-social-default"><a class='wsite-social-item wsite-social-twitter' href='http://twitter.com/michaelcade1' target='_blank'><span class='wsite-social-item-inner'></span></a><a class='wsite-social-item wsite-social-linkedin' href='http://uk.linkedin.com/in/MichaelCade1' target='_blank'><span class='wsite-social-item-inner'></span></a><a class='wsite-social-item wsite-social-mail' href='mailto:michael.cade@outlook.com' target='_blank'><span class='wsite-social-item-inner'></span></a></span>
<div style="height:0px;overflow:hidden"></div></div></td>
					</tr>
				</table>
				<div class="search"></div>
			</td>
		</tr>
	</table>
	<div id="main-bot">
		<div id="main-top">
			<div id="main">
				<div id="navigation">
					<ul class='wsite-menu-default'><li id='pg585258828175266744'><a href='../../../index.html'>Home</a></li><li id='pg127302207674349487'><a href='../../../about-vzilla.html'>About vZilla</a></li><li id='pg459605263778525960'><a href='../../../vzilla-homelab.html'>vZilla HomeLab</a></li><li id='active'><a href='../../../vzilla-blog.html'>vZilla Blog</a></li></ul>
					<div class="clear"></div>
					<em id="tl"></em>
					<em id="tr"></em>
					<em id="bl"></em>
					<em id="br"></em>
				</div>
				<div id="banner-bot">
					<div id="banner-top">
						<div id="banner">
							<div class="wsite-header"></div>
						</div>
					</div>
				</div>
				<div id="content">
					<table style='border: 0; width: 100%; table-layout: fixed' id='blogTable'><tr><td valign='top'><div id='894781723381334435-blog' class='blog-body' style='float: left;'>
<div id='wsite-content'><div id='blog-post-818093850692252273' class='blog-post'><div class='blog-header'><h2 class='blog-title'><a href='/1/post/2015/04/veeam-netapp-snapshots.html' class='blog-title-link' class='blog-link'>NetApp Storage Snapshots with Veeam</a></h2> <p class='blog-date'><span class='date-text'>28/04/2015</span></p><!-- 818093850692252273 -->
<p class='blog-comments'><a href='/1/post/2015/04/veeam-netapp-snapshots.html#comments' class='blog-link'>26 Comments</a></p></div><div class='blog-separator'> &nbsp; </div><div class='blog-content'><div><div class="wsite-image wsite-image-border-thin " style="padding-top:10px;padding-bottom:10px;margin-left:0;margin-right:0;text-align:center"> <a> <img src="/uploads/3/2/3/9/3239227/2226652_orig.png" alt="Picture" style="width:100%;max-width:600px" /> </a> <div style="display:block;font-size:90%"></div> </div></div>  <div class="paragraph" style="text-align:left;">           I have been asked by a number of people since joining Veeam about the NetApp Storage Snapshot Support in version 8 of the software. This is the reason for this post to try and outline the Why and the How use cases for the Veeam &amp; NetApp Storage integration. <br /><span style=""></span><br /><span></span>Firstly I want to go over the process of Veeam and any non storage snapshot enabled array (not supported with Veeam today) <br /><span style=""></span><br /><span style=""></span>    Veeam uses the VMware snapshot technology, when taking a backup we need to ensure that everything is consistent this is either done by using Veeam Application Aware Image Processing which will talk to the VSS directly through a runtime component this then ensures the application is in a quiesced state, at this stage the Veeam backup job can also truncate the application logs, this can also be done after a backup to ensure a successful backup is taken first. <br /><span style=""></span><br /><span style=""></span>    The second option is by using VMware tools for Windows machines, this will perform a file level integration with VSS, there is also an option within Veeam to use pre and post snapshot scripts. <br /><span style=""></span><br /><span style=""></span>    When the above has taken place and the virtual machine is in a consistent state Veeam triggers the VMware snapshot.&nbsp; At this point we have a capture of the virtual machine at that point in time. <br /><span style=""></span><br /><span style=""></span>    To understand the benefits we need to dive a little deeper first. Before the snapshot is created the virtual machine is reading and writing to and from the *.VMDK file of the virtual machine. After the snapshot is taken VMware will create a delta disk. This disk will be tiny in comparison to the VMDK disk to begin with&hellip; however for the duration of the snapshot lifetime all virtual machine writes are re directed to this delta disk. Reads will continue to come from the *.VMDK file if the blocks have not been written to since the snapshot. <br /><span style=""></span><br /><span style=""></span>    Very important to note is that VMware snapshots are not transactional, if a block is updated more than once the block in the sparse delta disk will be updated and not taking additional space, this means that the delta can grow to the size of the *.VMDK file. <br /><span style=""></span><br /><span style=""></span>    <ol style="" "margin-left:.375in;direction:ltr;unicode-bidi:embed;="" margin-top:0in;margin-bottom:0in;font-family:calibri;font-size:11.0pt;="" font-weight:normal;font-style:normal"=""><li style="">Ensure via VSS that      application and OS is consistent </li><li style="">Trigger VMware Snapshot </li><li style="">VMware snapshot created </li><li style="">Creates delta disk for new      writes </li></ol><br /><br /><span></span><br /><span></span>    For the most part this doesn&rsquo;t offer too much concern, the window of opportunity for the backup application is to take a copy of that *.VMDK as fast as possible avoiding too many writes to the delta disk because in turn these writes to the data disks need to be committed back to the *.VMDK file.&nbsp; The good thing in the most part is Veeam is also able to make use of the VMware CBT feature (Change Block Tracking) which only changed blocks will need to be backed up since the last backup. <br /><span style=""></span><br /><span style=""></span>    If however you have a Heavy I/O virtual machine, there are potentially two issues you will have to face, <br /><span style=""></span><br /><span style=""></span>    1,&nbsp; snapshots will grow in 16MB extents and every time it does grow it needs to pause IO to the VMFS file system to allocate more space for the *.VMDK file (meta updates.) <br /><span style=""></span><br /><span style=""></span>  2,&nbsp; if you are using thin provisioned VMFS volume, the space will be taken from the containing SAN LUN, however when a snapshot is deleted it doesn&rsquo;t automatically reclaim the space on the SAN, leaving lots of possible white space on the Storage. <br /><span style=""></span><br /><span style=""></span>    As well as the above&nbsp; because this virtual machine is IO intensive, it probably has changed a lot of blocks, the fact blocks have been changed means the backups could take longer. <br /><span><br /><span></span></span>          <a title="" style="" href="http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1015180">http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&amp;cmd=displayKC&amp;externalId=1015180</a><br /><br /><span style=""></span>      </div>  <div><div class="wsite-image wsite-image-border-thin " style="padding-top:10px;padding-bottom:10px;margin-left:0;margin-right:0;text-align:center"> <a> <img src="/uploads/3/2/3/9/3239227/4394562_orig.png" alt="Picture" style="width:100%;max-width:252px" /> </a> <div style="display:block;font-size:90%"></div> </div></div>  <div class="paragraph" style="text-align:left;">           How does the Veeam feature of Backup From Storage Snapshots assist in the above instances where you have&nbsp; high IO virtual machines that are transacting a large amount of changes. <br /><span style=""></span><br /><span style=""></span>    Firstly we have to create the storage snapshot first, this is done in the same way but from the storage API and not the VMware console or Veeam console. But because the storage is taking the snapshot this allows us to keep that sparse delta disk for a very short period of time meaning less space taken by new writes and also less time to commit/consolidate back to the *.VMDK file. <br /><span style=""></span><br /><span style=""></span>        </div>  <div><div class="wsite-image wsite-image-border-none " style="padding-top:10px;padding-bottom:10px;margin-left:0;margin-right:0;text-align:center"> <a> <img src="/uploads/3/2/3/9/3239227/7540652_orig.png" alt="Picture" style="width:100%;max-width:662px" /> </a> <div style="display:block;font-size:90%"></div> </div></div>  <div class="paragraph" style="text-align:left;">           The beauty of the Veeam Backup from Storage Snapshots is that Veeam can directly connect to the storage system and read the data. Veeam will still create the sparse delta file but only for 2 mins meaning the benefits I just mentioned. <br /><span style=""></span><br /><span style=""></span>    This generally poses another question are we shifting the workload from the VMware layer down to the storage? No not in the case of NetApp and most other storage vendors for that matter, simply because of the way the storage snapshot technology has been written, NetApp snapshots only point to blocks if the snapshot is deleted there is no need to commit anything back into the volume, the snapshot (pointers) are just removed. <br /><span style=""></span><br /><span style=""></span>    The key to this feature is the taking the time away from lengthy IO virtual machine backups but also taking the load away from your live VMware environment, by using the DirectSAN feature from Veeam you are able to connect to the storage snapshots and utilise the storage snapshots to perform backups rather than hitting the ESXi host. <br /><span style=""></span><br /><span style=""></span>    The above touches on the speed of which we can take our backups and reduce a workload in leveraging the NetApp storage system snapshots. But also we have a number of benefits when it comes to restoring. <br /><span style=""></span><br /><span style=""></span>  Easily recover individual items from NetApp Snapshot, SnapMirror and SnapVault all of these NetApp features are based on the snapshot technology. <br /><span style=""></span>      </div>  <div><div class="wsite-image wsite-image-border-none " style="padding-top:10px;padding-bottom:10px;margin-left:0;margin-right:0;text-align:center"> <a> <img src="/uploads/3/2/3/9/3239227/6596939_orig.png" alt="Picture" style="width:100%;max-width:832px" /> </a> <div style="display:block;font-size:90%"></div> </div></div>  <div class="paragraph" style="text-align:left;">          With this also in mind we are able to take a second backup and archive off to a second site and leverage NetApp Snapvault. This solution allows you to reach the&nbsp; 3-2-1 rule (3 backups on 2 media types with 1 off site backup) so 3 copies of your data.<br /><span style=""></span><br /><span style=""></span>     </div>  <div><div class="wsite-image wsite-image-border-none " style="padding-top:10px;padding-bottom:10px;margin-left:0;margin-right:0;text-align:center"> <a> <img src="/uploads/3/2/3/9/3239227/8340134_orig.png" alt="Picture" style="width:100%;max-width:858px" /> </a> <div style="display:block;font-size:90%"></div> </div></div></div><div class='blog-social'><div class='blog-social-item'><a class='twitter-share-button' href='http://twitter.com/share?url=http%3A%2F%2Fvzilla.co.uk%2F1%2Fpost%2F2015%2F04%2Fveeam-netapp-snapshots.html' data-count='horizontal'></a></div><div class='blog-social-item blog-fb-like'><fb:like href='http://vzilla.co.uk/1/post/2015/04/veeam-netapp-snapshots.html' show_faces='false' layout='button_count' width='90'></fb:like></div><div style='clear:both'></div></div>
<div class='blog-comments-bottom'><a href='/1/post/2015/04/veeam-netapp-snapshots.html#comments' class='blog-link'>26 Comments</a></div><div class='blog-post-separator'>&nbsp;</div>

</div><!-- bid: 664567885456871353 --></div>
</div>
</td><td class='blog-sidebar' valign='top'><div id='894781723381334435-sidebar' class='column-blog'><div class='blog-sidebar-separator'><ul id='894781723381334435-sidebar-list' class='columnlist-blog' style='margin:0; padding: 0;'> <h2 class="blog-author-title" style="text-align:left;">vZilla.co.uk</h2>
<p style="text-align:left;">As you can probably tell my name is not vZilla.co.uk, as stated on the home page the views are of my own and not of my employer.&nbsp;</p>

<h2 class="blog-archives-title" style="text-align:left;">Archives</h2>
<p class='blog-archive-list'><a href='../01-2016/1.html' class='blog-link'>January 2016</a><br />
<a href='../11-2015/1.html' class='blog-link'>November 2015</a><br />
<a href='../10-2015/1.html' class='blog-link'>October 2015</a><br />
<a href='../09-2015/1.html' class='blog-link'>September 2015</a><br />
<a href='../07-2015/1.html' class='blog-link'>July 2015</a><br />
<a href='../05-2015/1.html' class='blog-link'>May 2015</a><br />
<a href='1.html' class='blog-link'>April 2015</a><br />
<a href='../03-2015/1.html' class='blog-link'>March 2015</a><br />
<a href='../02-2015/1.html' class='blog-link'>February 2015</a><br />
<a href='../01-2015/1.html' class='blog-link'>January 2015</a><br />
<a href='../12-2014/1.html' class='blog-link'>December 2014</a><br />
<a href='../11-2014/1.html' class='blog-link'>November 2014</a><br />
<a href='../08-2014/1.html' class='blog-link'>August 2014</a><br />
<a href='../07-2014/1.html' class='blog-link'>July 2014</a><br />
<a href='../06-2014/1.html' class='blog-link'>June 2014</a><br />
<a href='../01-2014/1.html' class='blog-link'>January 2014</a><br />
<a href='../12-2013/1.html' class='blog-link'>December 2013</a><br />
<a href='../07-2013/1.html' class='blog-link'>July 2013</a><br />
<a href='../04-2013/1.html' class='blog-link'>April 2013</a><br />
</p>

<h2 class="blog-category-title" style="text-align:left;">Categories</h2>
<p class='blog-category-list'><a href='../../category/all/1.html' class='blog-link'>All</a><br />
</p>

<p class='blog-feed-link'><a href='../../feed'><img src='http://www.dragndropbuilder.com/editor/images/common/bg_feed.gif' /> RSS Feed</a></p> </ul></div></div></td></tr></table><hr style='visibility: hidden; clear: both;' />
					<div class="clear"></div>
				</div>
			</div>
		</div>
	</div>
	<div id="footer">
		<div class='wsite-elements wsite-footer'>
<div><div class="wsite-multicol"><div class='wsite-multicol-table-wrap' style='margin:0 -15px'>
<table class='wsite-multicol-table'>
<tbody class='wsite-multicol-tbody'>
<tr class='wsite-multicol-tr'>
<td class='wsite-multicol-col' style='width:50%;padding:0 15px'></td>
<td class='wsite-multicol-col' style='width:50%;padding:0 15px'></td>
</tr>
</tbody>
</table>
</div></div></div>

<div class="paragraph"><a href='http://www.ipage.com/' target='_blank'>Web Hosting</a> by iPage</div></div><script type='text/javascript'>
<!--

if (document.cookie.match(/(^|;)\s*is_mobile=1/)) {
	var windowHref = window.location.href || '';
	if (windowHref.indexOf('?') > -1) {
		windowHref += '&';
	} else {
		windowHref += '?';
	}
	document.write(
		"&nbsp;&nbsp;&nbsp;&nbsp;" +
		"<a class='wsite-view-link-mobile' href='" + windowHref + "view=mobile'>Mobile Site</a>"
	);
}

//-->
</script>

		<div class="clear"></div>
	</div>
</div>

<div id='fb-root'></div><script type='text/javascript'>(function() {function j(src, root) {var s = document.createElement('script');s.type = 'text/javascript';s.async = true;s.src = src;(root || document.getElementsByTagName('head')[0]).appendChild(s);}j('http://connect.face'+'book.net/en_US/all.js#xfbml=1', document.getElementById('fb-root'));j('http://platform.twi'+'tter.com/widgets.js');})()</script>
</body>
</html>